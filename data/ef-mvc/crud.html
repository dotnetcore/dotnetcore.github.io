<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>ASP.NET Core MVC &#19982; EF Core - &#23454;&#29616;CRUD - 2 of 10 | Microsoft &#25991;&#26723;&#65288;&#20013;&#25991;&#25991;&#26723;&#65289; </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="ASP.NET Core MVC &#19982; EF Core - &#23454;&#29616;CRUD - 2 of 10 | Microsoft &#25991;&#26723;&#65288;&#20013;&#25991;&#25991;&#26723;&#65289; ">
    <meta name="generator" content="docfx 2.18.2.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="/foo">
    <meta property="docfx:tocrel" content="../../toc.html">
    
    
  </head>
  <body data-spy="scroll" data-target="#affix">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">åˆ‡æ¢å¯¼èˆª</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">æ˜¾ç¤º / éšè—ç›®å½•</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="data/ef-mvc/crud">
<h1 id="åˆ›å»ºè¯»å–æ›´æ–°ä¸åˆ é™¤---aspnet-core-mvc-ä¸-ef-core-mvc-æ•™ç¨‹-2-of-10">åˆ›å»ºã€è¯»å–ã€æ›´æ–°ä¸åˆ é™¤ - ASP.NET Core MVC ä¸ EF Core MVC æ•™ç¨‹ (2 of 10)</h1>

<p>ä½œè€… <a href="https://github.com/tdykstra">Tom Dykstra</a> ã€ <a href="https://twitter.com/RickAndMSFT">Rick Anderson</a></p>
<p>ç¿»è¯‘ <a href="https://github.com/kiler398/">è°¢ç‚€ï¼ˆKilerï¼‰</a> </p>
<p>Contoso å¤§å­¦ Webåº”ç”¨ç¨‹åºæ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Entity Framework Core 1.1 ä»¥åŠ Visual Studio 2017 æ¥åˆ›å»º ASP.NET Core 1.1 MVC Web åº”ç”¨ç¨‹åºã€‚æ›´å¤šä¿¡æ¯è¯·å‚è€ƒ <a href="intro.html">ç¬¬ä¸€èŠ‚æ•™ç¨‹</a>.</p>
<p>åœ¨ä¹‹å‰çš„æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Entity Framework åŠ SQL Server LocalDB åˆ›å»ºäº†ä¸€ä¸ªç”¨æ¥å­˜å‚¨å’Œæ˜¾ç¤ºæ•°æ®çš„MVCåº”ç”¨ç¨‹åºã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œä½ å°†å®¡é˜…å¹¶å®šä¹‰ MVC åŸºæ¶åœ¨æ§åˆ¶å™¨å’Œè§†å›¾ä¸­è‡ªåŠ¨ä¸ºæ‚¨åˆ›å»ºçš„ CRUD (åˆ›å»ºã€è¯»å–ã€æ›´æ–°ã€åˆ é™¤)ä»£ç ã€‚</p>
<div class="NOTE"><h5>å¤‡æ³¨</h5><p>æŒ‰ç…§æƒ¯ä¾‹æˆ‘ä»¬åº”è¯¥å®ç°ä»“å‚¨æ¨¡å¼ï¼Œå³åœ¨ä½ çš„æ§åˆ¶å™¨å’Œæ•°æ®å­˜å–å±‚ä¹‹é—´åˆ›å»ºä¸€ä¸ªæŠ½è±¡å±‚æ¥å­˜å–æ•°æ®ã€‚ä½†æ˜¯ä¸ºäº†ä¿æŒæ•™ç¨‹çš„ç®€æ´å¹¶å°†æ³¨æ„åŠ›èšç„¦åœ¨å¦‚ä½•ä½¿ç”¨ Entity Framework æœ¬èº«ï¼Œæˆ‘ä»¬åœ¨æœ¬æ•™ç¨‹ä¸­æ²¡æœ‰ä½¿ç”¨ä»“å‚¨æ¨¡å¼ã€‚æ›´å¤šçš„ä¿¡æ¯è¯·å‚é˜… <a href="advanced.html">æœ€åä¸€èŠ‚æ•™ç¨‹</a>ã€‚</p>
</div>
<p>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œä½ å°†å»ºç«‹ä»¥ä¸‹Webé¡µé¢ï¼š</p>
<p><img src="crud/static/student-details.png" alt="Student Details page"></p>
<p><img src="crud/static/student-create.png" alt="Student Create page"></p>
<p><img src="crud/static/student-edit.png" alt="Student Edit page"></p>
<p><img src="crud/static/student-delete.png" alt="Student Delete page"></p>
<h2 id="åˆ›å»ºä¸€ä¸ªè¯¦ç»†é¡µé¢">åˆ›å»ºä¸€ä¸ªè¯¦ç»†é¡µé¢</h2>
<p>åŸºæ¶ä»£ç å°† <code>Enrollments</code> å±æ€§æ’é™¤åœ¨å­¦ç”Ÿç´¢å¼•é¡µé¢å¤–ï¼Œå› ä¸ºè¯¥å±æ€§æ˜¯ä¸€ä¸ªé›†åˆã€‚åœ¨ <strong>è¯¦ç»†</strong> é¡µé¢ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨ HTML è¡¨æ ¼ä¸­æ˜¾ç¤ºé›†åˆä¸­çš„å†…å®¹ã€‚</p>
<p>åœ¨ <em>Controllers/StudentsController.cs</em> ä»£ç ä¸­ï¼Œè¯¦ç»†è§†å›¾çš„ action æ–¹æ³•ä½¿ç”¨ <code>SingleOrDefaultAsync</code> æ–¹æ³•æ¥è¯»å–å•ä¸ª <code>Student</code> å®ä½“ã€‚ æŒ‰ç…§ä¸‹é¢çš„é«˜äº®ä»£ç æ·»åŠ ä»£ç è°ƒç”¨ <code>Include</code>. <code>ThenInclude</code>ï¼Œ ä»¥åŠ <code>AsNoTracking</code> æ–¹æ³•ã€‚</p>
<pre><code class="lang-csharp" name="Main" highlight-lines="8-12">public async Task&lt;IActionResult&gt; Details(int? id)
{
    if (id == null)
    {
        return NotFound();
    }

    var student = await _context.Students
        .Include(s =&gt; s.Enrollments)
            .ThenInclude(e =&gt; e.Course)
        .AsNoTracking()
        .SingleOrDefaultAsync(m =&gt; m.ID == id);

    if (student == null)
    {
        return NotFound();
    }

    return View(student);
}
</code></pre><p> <code>Include</code> å’Œ <code>ThenInclude</code> æ–¹æ³•ä¼šå¯¼è‡´ context åŠ è½½ <code>Student.Enrollments</code> å¯¼èˆªå±æ€§ï¼Œå¹¶ä¸”æ¯ä¸ª Enrollment çš„ <code>Enrollment.Course</code> å¯¼èˆªå±æ€§ä¹Ÿä¼šåŠ è½½ã€‚ å…³äºè¿™ä¸ªæ–¹æ³•çš„æ›´å¤šå†…å®¹è¯·å‚è€ƒ <a href="read-related-data.html">è¯»å–å…³è”æ•°æ®</a> æ•™ç¨‹ã€‚</p>
<p>â€œAsNoTrackingâ€ æ–¹æ³•åœ¨å½“å‰ä¸Šä¸‹æ–‡ç”Ÿå‘½å‘¨æœŸå†…è¿”å›çš„å®ä½“ä¸ä¼šæ›´æ–°çš„æƒ…å†µä¸‹å¯ä»¥æé«˜æ€§èƒ½ï¼Œåœ¨æœ¬æ•™ç¨‹æœ€åä½ å¯ä»¥äº†è§£æ›´å¤šå…³äº <code>AsNoTracking</code> çš„ä¿¡æ¯ã€‚</p>
<h3 id="è·¯ç”±æ•°æ®">è·¯ç”±æ•°æ®</h3>
<p>ä¼ é€’ç»™ <code>Details</code> æ–¹æ³•çš„é”®å€¼æ¥è‡ª <strong>è·¯ç”±æ•°æ®</strong> ï¼Œè·¯ç”±æ•°æ®æ˜¯æ¨¡å‹ç»‘å®šå™¨åœ¨ URL æ®µä¸­æ‰¾åˆ°çš„æ•°æ®ã€‚ ä¾‹å¦‚ï¼Œé»˜è®¤è·¯ç”±æŒ‡å®šcontrollerï¼Œaction ä»¥åŠ idæ®µï¼š</p>
<pre><code class="lang-csharp" name="Main" highlight-lines="5">app.UseMvc(routes =&gt;
{
    routes.MapRoute(
        name: &quot;default&quot;,
        template: &quot;{controller=Home}/{action=Index}/{id?}&quot;);
});

DbInitializer.Initialize(context);
</code></pre><p>åœ¨ä¸‹é¢ URL ä¸­ï¼Œé»˜è®¤è·¯ç”±å°† Instructor ä½œä¸ºæ§åˆ¶å™¨ï¼ŒIndex ä½œä¸º actionï¼Œå°† 1 ä½œä¸º id; è¿™äº›å°±æ˜¯è·¯ç”±æ•°æ®çš„å€¼ã€‚</p>
<pre><code>http://localhost:1230/Instructor/Index/1?courseID=2021
</code></pre><p>URL çš„æœ€åä¸€éƒ¨åˆ† (&quot;?courseID=2021&quot;) æ˜¯æŸ¥è¯¢å­—ç¬¦ä¸²å€¼ã€‚ å¦‚æœå°†å®ƒä½œä¸ºæŸ¥è¯¢å­—ç¬¦ä¸²å€¼ä¼ é€’ï¼Œæ¨¡å‹ç»‘å®šå™¨ä¹Ÿä¼šå°† I Dçš„å€¼ä¼ é€’ç»™ <code>Details</code> æ–¹æ³• <code>id</code> å‚æ•°ï¼š</p>
<pre><code>http://localhost:1230/Instructor/Index?id=1&amp;CourseID=2021
</code></pre><p>åœ¨ç´¢å¼•é¡µé¢ä¸­ï¼Œè¶…é“¾æ¥ URL ç”± Razor è§†å›¾ä¸­çš„ tag helper è¯­æ³•åˆ›å»ºã€‚ åœ¨ä»¥ä¸‹ Razor ä»£ç ä¸­ï¼Œ <code>id</code> å‚æ•°ä¸é»˜è®¤è·¯ç”±åŒ¹é…ï¼Œæ‰€ä»¥ <code>id</code> è¢«æ·»åŠ åˆ°è·¯ç”±æ•°æ®ä¸­ã€‚</p>
<pre><code class="lang-html">&lt;a asp-action=&quot;Edit&quot; asp-route-id=&quot;@item.ID&quot;&gt;Edit&lt;/a&gt;
</code></pre><p>å½“ <code>item.ID</code> ä¸º6æ—¶ï¼Œä¼šç”Ÿæˆä»¥ä¸‹HTMLï¼š</p>
<pre><code class="lang-html">&lt;a href=&quot;/Students/Edit/6&quot;&gt;Edit&lt;/a&gt;
</code></pre><p>åœ¨ä»¥ä¸‹çš„ Razor ä»£ç ä¸­ï¼Œ <code>studentID</code> ä¸é»˜è®¤è·¯ç”±ä¸­çš„å‚æ•°ä¸åŒ¹é…ï¼Œå› æ­¤å®ƒè¢«æ·»åŠ ä¸ºæŸ¥è¯¢å­—ç¬¦ä¸²ã€‚
In the following Razor code, <code>studentID</code> doesn&#39;t match a parameter in the default route, so it&#39;s added as a query string.</p>
<pre><code class="lang-html">&lt;a asp-action=&quot;Edit&quot; asp-route-studentID=&quot;@item.ID&quot;&gt;Edit&lt;/a&gt;
</code></pre><p>å½“ <code>item.ID</code> ä¸º6æ—¶ï¼Œä¼šç”Ÿæˆä»¥ä¸‹HTMLï¼š</p>
<pre><code class="lang-html">&lt;a href=&quot;/Students/Edit?studentID=6&quot;&gt;Edit&lt;/a&gt;
</code></pre><p>æ›´å¤šå…³äº tag helpers çš„ä¿¡æ¯ï¼Œ è¯·å‚è€ƒ <a class="xref" href="../../mvc/views/tag-helpers/intro.html">ASP.NET Core çš„ Tag helpers</a>.</p>
<h3 id="æ·»åŠ -enrollments-åˆ°è¯¦ç»†è§†å›¾">æ·»åŠ  enrollments åˆ°è¯¦ç»†è§†å›¾</h3>
<p>æ‰“å¼€ <em>Views/Students/Details.cshtml</em>ï¼Œæ¯ä¸ªå­—æ®µéƒ½æ˜¯ä½¿ç”¨ <code>DisplayNameFor</code> ä»¥åŠ <code>DisplayFor</code> helper æ¥å‘ˆç°çš„ï¼Œå¦‚ä¸‹é¢çš„ä»£ç æ‰€ç¤ºï¼š</p>
<pre><code class="lang-html" highlight-lines="2,5">&lt;dt&gt;
    @Html.DisplayNameFor(model =&gt; model.LastName)
&lt;/dt&gt;
&lt;dd&gt;
    @Html.DisplayFor(model =&gt; model.LastName)
&lt;/dd&gt;
</code></pre><p>åœ¨æœ€åä¸€ä¸ªå­—æ®µä¹‹åï¼Œå¹¶ä¸”åœ¨å…³é—­ <code>&lt;/dl&gt;</code> æ ‡è®°ä¹‹å‰ï¼Œæ·»åŠ ä»¥ä¸‹ä»£ç ä»¥æ¥æ˜¾ç¤º enrollments åˆ—è¡¨ï¼š</p>
<pre><code class="lang-html">&lt;dt&gt;
    @Html.DisplayNameFor(model =&gt; model.Enrollments)
&lt;/dt&gt;
&lt;dd&gt;
    &lt;table class=&quot;table&quot;&gt;
        &lt;tr&gt;
            &lt;th&gt;Course Title&lt;/th&gt;
            &lt;th&gt;Grade&lt;/th&gt;
        &lt;/tr&gt;
        @foreach (var item in Model.Enrollments)
        {
            &lt;tr&gt;
                &lt;td&gt;
                    @Html.DisplayFor(modelItem =&gt; item.Course.Title)
                &lt;/td&gt;
                &lt;td&gt;
                    @Html.DisplayFor(modelItem =&gt; item.Grade)
                &lt;/td&gt;
            &lt;/tr&gt;
        }
    &lt;/table&gt;
&lt;/dd&gt;
</code></pre><p>ç²˜è´´ä»£ç åï¼Œå¦‚æœä»£ç å‡ºç°ç¼©è¿›é”™è¯¯ï¼Œè¯·ä½¿ç”¨ CTRL-K-D å¿«æ·é”®è¿›è¡Œæ›´æ­£ã€‚</p>
<p>è¿™æ®µä»£ç éå† <code>Enrollments</code> å¯¼èˆªå±æ€§ä¸­çš„å®ä½“ã€‚ å¯¹äºæ¯ä¸ª enrollmentï¼Œå®ƒå°†æ˜¾ç¤ºè¯¾ç¨‹æ ‡é¢˜å’Œæˆç»©ã€‚ è¯¾ç¨‹æ ‡é¢˜æ˜¯ä»å­˜å‚¨åœ¨ Enrollments å®ä½“ä¸­çš„ <code>Course</code> å¯¼èˆªå±æ€§ä¸­çš„è¯¾ç¨‹å®ä½“ä¸­æ£€ç´¢å‡ºæ¥çš„ã€‚</p>
<p>è¿è¡Œåº”ç”¨ç¨‹åºï¼Œé€‰æ‹© <strong>Students</strong> é€‰é¡¹å¡ï¼Œç„¶åå•å‡»å­¦ç”Ÿçš„ <strong>Details</strong> é“¾æ¥ã€‚ æ‚¨ä¼šçœ‹åˆ°æ‰€é€‰å­¦ç”Ÿçš„è¯¾ç¨‹å’Œæˆç»©åˆ—è¡¨ï¼š</p>
<p><img src="crud/static/student-details.png" alt="Student Details page"></p>
<h2 id="æ›´æ–°åˆ›å»ºé¡µé¢">æ›´æ–°åˆ›å»ºé¡µé¢</h2>
<p>åœ¨  <em>StudentsController.cs</em> ä¸­ï¼Œé€šè¿‡æ·»åŠ ä¸€ä¸ª try-catch ä»£ç å—å¹¶ä» <code>Bind</code> å±æ€§ä¸­ç§»é™¤ ID æ¥ä¿®æ”¹ HttpPost <code>Create</code> æ–¹æ³•ã€‚</p>
<pre><code class="lang-csharp" name="Main" highlight-lines="4,6-7,14-21">[HttpPost]
[ValidateAntiForgeryToken]
public async Task&lt;IActionResult&gt; Create(
    [Bind(&quot;EnrollmentDate,FirstMidName,LastName&quot;)] Student student)
{
    try
    {
        if (ModelState.IsValid)
        {
            _context.Add(student);
            await _context.SaveChangesAsync();
            return RedirectToAction(&quot;Index&quot;);
        }
    }
    catch (DbUpdateException /* ex */)
    {
        //Log the error (uncomment ex variable name and write a log.
        ModelState.AddModelError(&quot;&quot;, &quot;Unable to save changes. &quot; +
            &quot;Try again, and if the problem persists &quot; +
            &quot;see your system administrator.&quot;);
    }
    return View(student);
}
</code></pre><p>è¿™æ®µä»£ç å°†ç”± ASP.NET MVC æ¨¡å‹ç»‘å®šå™¨åˆ›å»ºçš„ Student å®ä½“æ·»åŠ åˆ° Students å®ä½“é›†ï¼Œç„¶åå°†æ›´æ”¹ä¿å­˜åˆ°æ•°æ®åº“ã€‚ ï¼ˆæ¨¡å‹ç»‘å®šå™¨æ˜¯æŒ‡ ASP.NET MVC åŠŸèƒ½ï¼Œä½¿æ‚¨æ›´å®¹æ˜“å¤„ç†è¡¨å•æäº¤çš„æ•°æ®;æ¨¡å‹ç»‘å®šå™¨å°†å‘å¸ƒçš„è¡¨å•å€¼è½¬æ¢ä¸º CLR ç±»å‹ï¼Œå¹¶å°†è¿™äº›å€¼ä¼ é€’ç»™æ“ä½œæ–¹æ³•ä¸­çš„å‚æ•°ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ æ¨¡å‹ç»‘å®šå™¨ä½¿ç”¨ Form é›†åˆä¸­çš„å±æ€§å€¼å®ä¾‹åŒ–æ‚¨çš„ Student å®ä½“ã€‚ï¼‰</p>
<p>æ‚¨ä» <code>Bind</code> å±æ€§ä¸­åˆ é™¤äº† <code>ID</code> ï¼Œå› ä¸º ID æ˜¯å½“æ’å…¥è¡Œæ—¶ SQL Server æ•°æ®åº“å°†è¢«è‡ªåŠ¨è®¾ç½®çš„ä¸»é”®å€¼ã€‚ ç”¨æˆ·çš„æ— éœ€è¾“å…¥æˆ–è€…è®¾ç½® ID å€¼ã€‚</p>
<p>é™¤äº† <code>Bind</code> å±æ€§ä¹‹å¤–ï¼Œä½ åªéœ€è¦ä¿®æ”¹åŸºæ¶ä»£ç ä¸­çš„ try-catch ä»£ç å—ã€‚ å¦‚æœåœ¨ä¿å­˜æ›´æ”¹æ—¶æ•è· <code>DbUpdateException</code> çš„å¼‚å¸¸ï¼Œåˆ™ä¼šæ˜¾ç¤ºä¸€èˆ¬çš„é”™è¯¯æ¶ˆæ¯ã€‚ <code>DbUpdateException</code> å¼‚å¸¸æœ‰æ—¶ç”±åº”ç”¨ç¨‹åºå¤–éƒ¨å› ç´ å¼•èµ·ï¼Œè€Œä¸æ˜¯ç¨‹åºæœ¬èº«é”™è¯¯ï¼Œæ‰€ä»¥å»ºè®®ç”¨æˆ·å†è¯•ä¸€æ¬¡ã€‚ è™½ç„¶åœ¨æ­¤ç¤ºä¾‹ä¸­æœªå®ç°ï¼Œä½†ç”Ÿäº§ç¯å¢ƒçš„åº”ç”¨ç¨‹åºå°†è®°å½•å¼‚å¸¸ã€‚ æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…
<a href="http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/monitoring-and-telemetry">ç›‘æ§å’Œé¥æµ‹ (åœ¨ Azure æ„å»ºçœŸå®ä¸–ç•Œäº‘åº”ç”¨ç¨‹åº)</a>ä¸­çš„ <strong>æ—¥å¿—æ´å¯Ÿ</strong> ç« èŠ‚ã€‚</p>
<p><code>ValidateAntiForgeryToken</code> å±æ€§æœ‰åŠ©äºé˜²æ­¢è·¨ç«™ç‚¹è¯·æ±‚ä¼ªé€ ï¼ˆCSRFï¼‰æ”»å‡»ã€‚ ä»¤ç‰Œä¼šç”± <a class="xref" href="../../mvc/views/working-with-forms.html#the-form-tag-helper">FormTagHelper</a> è‡ªåŠ¨æ³¨å…¥åˆ°è§†å›¾ä¸­ï¼Œå¹¶åœ¨ç”¨æˆ·æäº¤è¡¨å•æ—¶åŒ…å«è¯¥ä»¤ç‰Œã€‚ ä»¤ç‰Œä¼šè¢« <code>ValidateAntiForgeryToken</code> å±æ€§éªŒè¯ã€‚ æœ‰å…³CSRFçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="../../security/anti-request-forgery.html">ğŸ”§ åè¯·æ±‚ä¼ªé€ </a>.</p>
<p><a id="overpost"></a></p>
<h3 id="å…³äº-overpostè¿‡åº¦æäº¤çš„å®‰å…¨è¯´æ˜">å…³äº overpostï¼ˆè¿‡åº¦æäº¤ï¼‰çš„å®‰å…¨è¯´æ˜</h3>
<p> åŸºæ¶ä»£ç ä¸­çš„ <code>Create</code> æ–¹æ³•ä¸­åŒ…å«çš„ <code>Bind</code> å±æ€§æ˜¯åœ¨åˆ›å»ºæ–¹æ¡ˆä¸­é˜²æ­¢overpostï¼ˆè¿‡åº¦æäº¤ï¼‰çš„ä¸€ç§æ–¹æ³•ã€‚ ä¾‹å¦‚ï¼Œå‡è®¾å­¦ç”Ÿå®ä½“åŒ…å«ä¸€ä¸ª <code>Secret</code> å±æ€§ï¼Œä½†æ˜¯æ‚¨åˆä¸å¸Œæœ›æ­¤å±æ€§åœ¨ç½‘é¡µè¿›è¡Œè®¾ç½®ã€‚</p>
<pre><code class="lang-csharp">public class Student
{
    public int ID { get; set; }
    public string LastName { get; set; }
    public string FirstMidName { get; set; }
    public DateTime EnrollmentDate { get; set; }
    public string Secret { get; set; }
}
</code></pre><p>å³ä½¿æ‚¨çš„ç½‘é¡µä¸Šæ²¡æœ‰ <code>Secret</code> å­—æ®µï¼Œé»‘å®¢ä¹Ÿå¯ä»¥ä½¿ç”¨è¯¸å¦‚ Fiddler ä¹‹ç±»çš„å·¥å…·ï¼Œæˆ–è€…å†™ä¸€äº› JavaScript æ¥ Post ä¸€ä¸ª <code>Secret</code> è¡¨å•å€¼ã€‚ æ²¡æœ‰ <code>Bind</code> å±æ€§é™åˆ¶æ¨¡å‹ç»‘å®šå™¨åˆ›å»º Student å®ä¾‹æ—¶ä½¿ç”¨çš„å­—æ®µï¼Œæ¨¡å‹ç»‘å®šå™¨å°†æŠ“å– <code>Secret</code> è¡¨å•å€¼ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥åˆ›å»ºå­¦ç”Ÿå®ä½“å®ä¾‹ã€‚ä¸ç®¡é»‘å®¢ä¸º <code>Secret</code> è¡¨å•åŸŸæŒ‡å®šçš„ä»€ä¹ˆå€¼éƒ½å°†åœ¨æ•°æ®åº“ä¸­è¢«æ›´æ–°ã€‚ ä»¥ä¸‹å›¾åƒæ˜¾ç¤ºäº†Fiddlerå·¥å…·å°† <code>Secret</code> å­—æ®µï¼ˆå¸¦æœ‰â€œOverPostâ€ï¼‰æ·»åŠ åˆ°å‘å¸ƒçš„è¡¨å•å€¼ã€‚</p>
<p><img src="crud/static/fiddler.png" alt="Fiddler adding Secret field"></p>
<p>ç„¶å&quot;OverPost&quot; çš„å€¼å°†æˆåŠŸæ·»åŠ åˆ°æ’å…¥åˆ°æ•°æ®è¡Œçš„ <code>Secret</code> å±æ€§ï¼Œå°½ç®¡æ‚¨ä»æœªæ‰“ç®—é€šè¿‡ç½‘é¡µå¯ä»¥è®¾ç½®è¯¥å±æ€§ã€‚</p>
<p>æ‚¨å¯ä»¥å…ˆé€šè¿‡å…ˆä»æ•°æ®åº“ä¸­è¯»å–å®ä½“ï¼Œç„¶åè°ƒç”¨ <code>TryUpdateModel</code> æ–¹æ³•ï¼Œæ˜¾å¼çš„ä¼ é€’ä¸€ä¸ªå…è®¸çš„å±æ€§åˆ—è¡¨ï¼Œä»è€Œé˜²æ­¢ç¼–è¾‘åœºæ™¯ä¸­çš„overpostï¼ˆè¿‡åº¦æäº¤ï¼‰ã€‚ è¿™æ˜¯è¿™äº›æ•™ç¨‹ä¸­ä½¿ç”¨çš„æ–¹æ³•ã€‚</p>
<p>è®¸å¤šå¼€å‘äººå‘˜é¦–é€‰çš„é˜²æ­¢overpostï¼ˆè¿‡åº¦æäº¤ï¼‰çš„å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨è§†å›¾æ¨¡å‹ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æ¨¡å‹ç»‘å®šçš„å®ä½“ç±»ã€‚ åœ¨è§†å›¾æ¨¡å‹ä¸­ä»…åŒ…å«è¦æ›´æ–°çš„å±æ€§ã€‚ ä¸€æ—¦ MVC æ¨¡å‹ç»‘å®šå®Œæˆï¼Œå°†è§†å›¾æ¨¡å‹å±æ€§å¤åˆ¶åˆ°å®ä½“å®ä¾‹ï¼Œå¯é€‰åœ°ä½¿ç”¨è¯¸å¦‚   AutoMapper ä¹‹ç±»çš„å·¥å…·ã€‚ åœ¨å®ä½“å®ä¾‹ä¸Šä½¿ç”¨ <code>_context.Entry</code> å°†å…¶çŠ¶æ€è®¾ç½®ä¸º <code>Unchanged</code>ï¼Œç„¶ååœ¨è§†å›¾æ¨¡å‹ä¸­åŒ…å«çš„æ¯ä¸ªå®ä½“å±æ€§ä¸Šè®¾ç½® <code>Property(&quot;PropertyName&quot;).IsModified</code> ä¸ºtrueã€‚ æ­¤æ–¹æ³•é€‚ç”¨äºç¼–è¾‘å’Œåˆ›å»ºåœºæ™¯ã€‚</p>
<h3 id="æµ‹è¯•åˆ›å»ºé¡µé¢">æµ‹è¯•åˆ›å»ºé¡µé¢</h3>
<p><em>Views/Students/Create.cshtml</em> ä¸­ ä¸­çš„ä»£ç ä¸ºæ¯ä¸ªå­—æ®µä½¿ç”¨ <code>label</code>ï¼Œ <code>input</code>ï¼Œ ä»¥åŠ <code>span</code> (ç”¨äºéªŒè¯æ¶ˆæ¯) tag helpersã€‚</p>
<p>è¿è¡Œé¡µé¢é€‰æ‹© <strong>Students</strong> é€‰é¡¹å¼€å¹¶ç‚¹å‡» <strong>Create New</strong>ã€‚</p>
<p>è¾“å…¥å§“åå’Œéæ³•æ—¥æœŸç‚¹å‡» <strong>Create</strong> ä¼šå‡ºç°é”™è¯¯ä¿¡æ¯ã€‚</p>
<p><img src="crud/static/date-error.png" alt="Date validation error"></p>
<p>è¿™æ˜¯æ‚¨çš„åº”ç”¨ç¨‹åºé»˜è®¤çš„æœåŠ¡å™¨ç«¯éªŒè¯; åœ¨åé¢çš„æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†çœ‹åˆ°å¦‚ä½•æ·»åŠ å°†ç”Ÿæˆå®¢æˆ·ç«¯éªŒè¯ä»£ç çš„å±æ€§ã€‚ ä»¥ä¸‹é«˜äº®æ˜¾ç¤ºçš„ä»£ç æ˜¾ç¤ºäº† <code>Create</code> æ–¹æ³•ä¸­çš„æ¨¡å‹éªŒè¯æ£€æŸ¥ã€‚</p>
<pre><code class="lang-csharp" name="Main" highlight-lines="8">[HttpPost]
[ValidateAntiForgeryToken]
public async Task&lt;IActionResult&gt; Create(
    [Bind(&quot;EnrollmentDate,FirstMidName,LastName&quot;)] Student student)
{
    try
    {
        if (ModelState.IsValid)
        {
            _context.Add(student);
            await _context.SaveChangesAsync();
            return RedirectToAction(&quot;Index&quot;);
        }
    }
    catch (DbUpdateException /* ex */)
    {
        //Log the error (uncomment ex variable name and write a log.
        ModelState.AddModelError(&quot;&quot;, &quot;Unable to save changes. &quot; +
            &quot;Try again, and if the problem persists &quot; +
            &quot;see your system administrator.&quot;);
    }
    return View(student);
}
</code></pre><p>å°†æ—¥æœŸæ›´æ”¹ä¸ºæœ‰æ•ˆå€¼ï¼Œç„¶åå•å‡» <strong>Create</strong> å¹¶åœ¨<strong>Index</strong> é¡µé¢ä¸­æŸ¥çœ‹æ–°æ·»åŠ å­¦ç”Ÿã€‚</p>
<h2 id="æ›´æ–°ç¼–è¾‘é¡µé¢">æ›´æ–°ç¼–è¾‘é¡µé¢</h2>
<p>åœ¨ <em>StudentController.cs</em>ä¸­ï¼ŒHttpGet <code>Edit</code> æ–¹æ³•(æ²¡æœ‰ <code>HttpPost</code> ç‰¹æ€§çš„é‚£ä¸€ä¸ª)ä½¿ç”¨ <code>SingleOrDefaultAsync</code>æ–¹æ³•æ¥æ£€ç´¢æ‰€é€‰æ‹©çš„ Student å®ä½“ï¼Œæ­£å¦‚ä½ åœ¨ <code>Details</code> æ–¹æ³•ä¸­çœ‹åˆ°çš„ä¸€æ ·ã€‚æ‚¨ä¸éœ€è¦æ›´æ–°æ­¤æ–¹æ³•ã€‚</p>
<h3 id="æ¨è-httppost-edit-ä»£ç è¯»å–å¹¶ä¸”æ›´æ–°">æ¨è HttpPost Edit ä»£ç ï¼šè¯»å–å¹¶ä¸”æ›´æ–°</h3>
<p>ç”¨ä¸‹åˆ—ä»£ç æ›¿æ¢ HttpPost Edit action æ–¹æ³•ã€‚</p>
<pre><code class="lang-csharp" name="Main">[HttpPost, ActionName(&quot;Edit&quot;)]
[ValidateAntiForgeryToken]
public async Task&lt;IActionResult&gt; EditPost(int? id)
{
    if (id == null)
    {
        return NotFound();
    }
    var studentToUpdate = await _context.Students.SingleOrDefaultAsync(s =&gt; s.ID == id);
    if (await TryUpdateModelAsync&lt;Student&gt;(
        studentToUpdate,
        &quot;&quot;,
        s =&gt; s.FirstMidName, s =&gt; s.LastName, s =&gt; s.EnrollmentDate))
    {
        try
        {
            await _context.SaveChangesAsync();
            return RedirectToAction(&quot;Index&quot;);
        }
        catch (DbUpdateException /* ex */)
        {
            //Log the error (uncomment ex variable name and write a log.)
            ModelState.AddModelError(&quot;&quot;, &quot;Unable to save changes. &quot; +
                &quot;Try again, and if the problem persists, &quot; +
                &quot;see your system administrator.&quot;);
        }
    }
    return View(studentToUpdate);
}
</code></pre><p>è¿™ä¸ªæ”¹åŠ¨æ˜¯å®ç°é˜²æ­¢overpostï¼ˆè¿‡åº¦æäº¤ï¼‰çš„æœ€ä½³å®è·µã€‚ åŸºæ¶ç”Ÿæˆä¸€ä¸ª <code>Bind</code> å±æ€§ï¼Œå¹¶å°†ç”±æ¨¡å‹ç»‘å®šå™¨åˆ›å»ºçš„å®ä½“æ·»åŠ åˆ°å…·æœ‰ <code>Modified</code> æ ‡å¿—çš„å®ä½“é›†ä¸­ã€‚ è¯¥ä»£ç ä¸æ¨èç”¨äºæ‰€æœ‰åœºæ™¯ï¼Œå› ä¸º <code>Bind</code> å±æ€§ä¼šæ¸…é™¤æœªåŒ…å«åœ¨ <code>Include</code> å‚æ•°ä¸­çš„ä»»ä½•é¢„å…ˆå­˜åœ¨çš„æ•°æ®ã€‚  </p>
<p>æ–°çš„ä»£ç è¯»å–ç°æœ‰å®ä½“ï¼Œå¹¶è°ƒç”¨ <code>TryUpdateModel</code> æ–¹æ³•æ¥æ›´æ–°ç”¨æˆ·åœ¨æäº¤è¡¨å•æ•°æ®ä¸­è¾“å…¥çš„æ•°æ®å¯¹åº”åˆ°å®ä½“ä¸­çš„å­—æ®µã€‚ Entity Framework è‡ªåŠ¨æ›´æ”¹è·Ÿè¸ªåœ¨é€šè¿‡è¡¨å•è¾“å…¥æ›´æ”¹çš„å­—æ®µä¸Šè®¾ç½® <code>Modified</code> æ ‡å¿—ã€‚ å½“è°ƒç”¨<code>SaveChanges</code>æ–¹æ³•æ—¶ï¼ŒEntity Frameworkä¼šåˆ›å»ºSQLè¯­å¥æ¥æ›´æ–°æ•°æ®åº“è¡Œã€‚ å¿½ç•¥å¹¶å‘å†²çªï¼Œåªæœ‰ç”¨æˆ·æ›´æ–°çš„è¡¨åˆ—åœ¨æ•°æ®åº“ä¸­æ›´æ–°ã€‚ ï¼ˆç¨åçš„æ•™ç¨‹å°†æ˜¾ç¤ºå¦‚ä½•å¤„ç†å¹¶å‘å†²çªã€‚ï¼‰</p>
<p>ä½œä¸ºé˜²æ­¢overpostï¼ˆè¿‡åº¦æäº¤ï¼‰çš„æœ€ä½³å®è·µï¼Œæ‚¨å¯ä»¥é€šè¿‡æŠŠ <strong>Edit</strong> é¡µé¢æ›´æ–°çš„å­—æ®µåˆ—å…¥ <code>TryUpdateModel</code> å‚æ•°çš„ç™½åå•åˆ—è¡¨ã€‚ ï¼ˆå‚æ•°åˆ—è¡¨ä¸­çš„å­—æ®µåˆ—è¡¨ä¹‹å‰çš„ç©ºå­—ç¬¦ä¸²æ˜¯ç”¨äºå®šä¹‰è¡¨å•å­—æ®µåç§°çš„å‰ç¼€çš„ã€‚ï¼‰ç›®å‰æ²¡æœ‰è¦ä¿æŠ¤çš„é¢å¤–å­—æ®µï¼Œä½†åˆ—å‡ºäº†æ‚¨å¸Œæœ›æ¨¡å‹ç»‘å®šå™¨ç»‘å®šçš„å­—æ®µ è¿™æ ·å¯ä»¥ç¡®ä¿æ‚¨å°†æ¥ä¸ºæ•°æ®æ¨¡å‹æ·»åŠ å­—æ®µçš„æ—¶å€™ï¼Œå®ƒä»¬å°†è‡ªåŠ¨å—åˆ°ä¿æŠ¤ï¼Œç›´åˆ°æ‚¨åœ¨æ­¤å¤„æ˜¾å¼æ·»åŠ ã€‚</p>
<p>ä½œä¸ºæ›´æ”¹çš„ç»“æœï¼Œå› ä¸ºHttpPost <code>Edit</code> æ–¹æ³•çš„æ–¹æ³•ç­¾åä¸HttpGet <code>Edit</code> æ–¹æ³•ç›¸åŒ; æ‰€ä»¥éœ€è¦æŠŠæ–¹æ³•é‡å‘½åä¸º <code>EditPost</code>çš„æ–¹æ³•ã€‚</p>
<h3 id="å¦ä¸€ä¸ª-httppost-edit-ä»£ç åˆ›å»ºå¹¶é™„åŠ ">å¦ä¸€ä¸ª HttpPost Edit ä»£ç ï¼šåˆ›å»ºå¹¶é™„åŠ </h3>
<p>æ¨èçš„ HttpPost ç¼–è¾‘ä»£ç å¯ä»¥ç¡®ä¿ä»…ä»…æ›´æ–°æ›´æ”¹è¿‡çš„åˆ—ï¼Œå¹¶ä¿ç•™ä¸éœ€è¦åŒ…å«åœ¨æ¨¡å‹ç»‘å®šçš„å±æ€§ä¸­çš„æ•°æ®ã€‚ ç„¶è€Œï¼Œé¦–å…ˆè¯»å–çš„æ–¹æ³•éœ€è¦é¢å¤–çš„æ•°æ®åº“è¯»å–æ“ä½œï¼Œå¹¶ä¸”å¯èƒ½ä¼šå¯¼è‡´éœ€è¦åŠ å…¥å¤„ç†å¹¶å‘å†²çªçš„æ›´å¤æ‚çš„ä»£ç ã€‚ å¦ä¸€ç§æ–¹æ³•æ˜¯å°†ç”±æ¨¡å‹ç»‘å®šå™¨åˆ›å»ºçš„å®ä½“é™„åŠ åˆ° EF ä¸Šä¸‹æ–‡å¹¶å°†å…¶æ ‡è®°ä¸ºå·²ä¿®æ”¹ã€‚ ï¼ˆä¸è¦ä½¿ç”¨æ­¤ä»£ç æ›´æ–°é¡¹ç›®ï¼Œè¿™ä»…ä»…æ˜¯å¯é€‰æ–¹æ¡ˆã€‚ï¼‰</p>
<pre><code class="lang-csharp" name="Main">public async Task&lt;IActionResult&gt; Edit(int id, [Bind(&quot;ID,EnrollmentDate,FirstMidName,LastName&quot;)] Student student)
{
    if (id != student.ID)
    {
        return NotFound();
    }
    if (ModelState.IsValid)
    {
        try
        {
            _context.Update(student);
            await _context.SaveChangesAsync();
            return RedirectToAction(&quot;Index&quot;);
        }
        catch (DbUpdateException /* ex */)
        {
            //Log the error (uncomment ex variable name and write a log.)
            ModelState.AddModelError(&quot;&quot;, &quot;Unable to save changes. &quot; +
                &quot;Try again, and if the problem persists, &quot; +
                &quot;see your system administrator.&quot;);
        }
    }
    return View(student);
}
</code></pre><p>å½“ç½‘é¡µ UI åŒ…å«å®ä½“ä¸­çš„æ‰€æœ‰å­—æ®µå¹¶ä¸”å…è®¸æ›´æ–°å®ƒä»¬æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ­¤æ–¹æ³•ã€‚</p>
<p>The scaffolded code uses the create-and-attach approach but only catches <code>DbUpdateConcurrencyException</code> exceptions and returns 404 error codes.  The example shown catches any database update exception and displays an error message.
åŸºæ¶ä»£ç ä½¿ç”¨ create-and-attach æ–¹å¼ï¼Œä½†åªèƒ½æ•è· <code>DbUpdateConcurrencyException</code> å¼‚å¸¸å¹¶è¿”å› 404 é”™è¯¯ä»£ç ã€‚ ç¤ºä¾‹å±•ç¤ºæ•è·æ•°æ®åº“æ›´æ–°å¼‚å¸¸å¹¶æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ã€‚</p>
<h3 id="å®ä½“çŠ¶æ€">å®ä½“çŠ¶æ€</h3>
<p>æ•°æ®åº“ä¸Šä¸‹æ–‡ä¼šè·Ÿè¸ªå†…å­˜ä¸­çš„å®ä½“æ˜¯å¦ä¸æ•°æ®åº“ä¸­çš„æ•°æ®è¡Œä¿æŒåŒæ­¥ã€‚å¹¶æ ¹æ®åŒæ­¥çš„ä¿¡æ¯æ¥ç¡®å®šè°ƒç”¨<code>SaveChanges</code> æ–¹æ³•æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚ä¾‹å¦‚ï¼Œè®©ä½ ä¼ é€’ä¸€ä¸ªæ–°å®ä½“ç»™ <code>Add</code> æ–¹æ³•ï¼Œè¯¥å®ä½“çš„çŠ¶æ€è®¾ç½®ä¸º <code>Added</code>ã€‚ç„¶åæ‚¨è°ƒç”¨ <code>SaveChanges</code> æ–¹æ³•æ—¶ï¼Œæ•°æ®åº“ä¸Šä¸‹æ–‡ä¼šç”Ÿæˆä¸€ä¸ª SQL Insert å‘½ä»¤ä»¥æ’å…¥æ•°æ®ã€‚</p>
<p>ä¸€ä¸ªå®ä½“å¯èƒ½å¤„äºä»¥ä¸‹çŠ¶æ€ï¼š</p>
<ul>
<li><p><code>Added</code>. å®ä½“å°šæœªåœ¨æ•°æ®åº“ä¸­ã€‚ <code>SaveChanges</code> æ–¹æ³•å°†äº§ç”Ÿä¸€ä¸ª Insert è¯­å¥ã€‚ </p>
</li>
<li><p><code>Unchanged</code>. <code>SaveChanges</code> å¯¹è¯¥å®ä½“ä»€ä¹ˆéƒ½ä¸éœ€è¦åšã€‚å½“ä½ ä»æ•°æ®åº“è¯»å‡ºä¸€ä¸ªå®ä½“æ—¶ï¼Œè¯¥å®ä½“å°±ä¸ºè¿™ä¸€çŠ¶æ€ã€‚ </p>
</li>
<li><p><code>Modified</code>. æŸäº›æˆ–æ‰€æœ‰å®ä½“çš„å±æ€§å€¼å·²éƒ½è¢«æ›´æ”¹ã€‚ <code>SaveChanges</code> å°†äº§ç”Ÿä¸€ä¸ªUpdateè¯­å¥ã€‚ </p>
</li>
<li><p><code>Deleted</code>. è¯¥å®ä½“å·²ç»è¢«æ ‡å¿—ä¸ºåˆ é™¤ã€‚ <code>SaveChanges</code> å°†äº§ç”Ÿä¸€ä¸ªDeleteè¯­å¥ã€‚ </p>
</li>
<li><p><code>Detached</code>. è¯¥å®ä½“æ²¡æœ‰è¢«æ•°æ®åº“ä¸Šä¸‹æ–‡æ‰€è·Ÿè¸ªã€‚</p>
</li>
</ul>
<p>åœ¨æ¡Œé¢åº”ç”¨ç¨‹åºä¸­ï¼ŒçŠ¶æ€å˜åŒ–é€šå¸¸æ˜¯è‡ªåŠ¨è®¾ç½®çš„ã€‚åœ¨æ¡Œé¢å‹çš„åº”ç”¨ç¨‹åºä¸­ï¼Œä½ çœ‹åˆ°ä¸€ä¸ªå®ä½“å¹¶æ›´æ”¹å®ƒçš„ä¸€äº›å±æ€§å€¼ï¼Œå°†å¯¼è‡´å®ƒçš„å®ä½“çŠ¶æ€è‡ªåŠ¨æ›´æ”¹ä¸º <code>Modified</code>ã€‚ç„¶åä½ è°ƒç”¨ <code>SaveChanges</code>ï¼Œå®ä½“æ¡†æ¶ç”Ÿæˆä¸€ä¸ª SQL Update æ¥æ›´æ–°ä½ è¿›è¡Œäº†å˜æ›´çš„å±æ€§ã€‚</p>
<p>Webåº”ç”¨ç¨‹åºçš„æ–­å¼€è¿æ¥æ€§è´¨ä¸å…è®¸è¿™ç§è¿ç»­åºåˆ—ã€‚ <code>DbContext</code> åœ¨è¯»å–åˆ°å®ä½“å¹¶å°†å…¶å‘ˆç°åœ¨é¡µé¢ä¸Šï¼Œä¹‹åä¾¿è¢«é”€æ¯ã€‚å½“ HttpPost <code>Edit</code> actionæ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œä¸€ä¸ªæ–°è¯·æ±‚è¢«å¤„ç†ï¼Œä½ å°†è·å–ä¸€ä¸ªæ–°çš„ <code>DbContext</code> çš„å®ä¾‹ã€‚æ‰€ä»¥ä½ å¿…é¡»æ‰‹åŠ¨è®¾ç½®å®ä½“çŠ¶æ€ä¸ºModifiedï¼Œç„¶åä½ è°ƒç”¨SaveChangesï¼Œå®ä½“æ¡†æ¶æ›´æ–°æ•°æ®åº“ä¸­çš„æ‰€æœ‰çš„æ•°æ®è¡Œï¼Œå› ä¸ºä¸Šä¸‹æ–‡æ²¡æœ‰åŠæ³•çŸ¥é“é‚£ä¸ªå±æ€§æ˜¯ä½ è¿›è¡Œäº†å˜æ›´çš„ã€‚</p>
<p>åœ¨ Web åº”ç”¨ç¨‹åºä¸­ï¼Œ <code>DbContext</code> åˆå§‹åŒ–è¯»å–å®ä½“å¹¶æ˜¾ç¤ºå…¶è¦ç¼–è¾‘çš„æ•°æ®å¹¶åœ¨é¡µé¢æ¸²æŸ“ä¹‹åè‡ªåŠ¨æ–½æ”¾ã€‚ å½“è°ƒç”¨ HttpPost <code>Edit</code> action æ–¹æ³•æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ Webè¯· æ±‚ï¼Œå¯¹åº”åŒ…å«ä¸€ä¸ªæ–°çš„ <code>DbContext</code> å®ä¾‹ã€‚ å¦‚æœæ‚¨åœ¨æ–°çš„ä¸Šä¸‹æ–‡ä¸­é‡æ–°è¯»å–äº†å®ä½“ï¼Œåˆ™å¯ä»¥å‚è€ƒæ¡Œé¢å¤„ç†ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœæ‚¨ä¸æƒ³æ‰§è¡Œé¢å¤–çš„è¯»å–æ“ä½œï¼Œåˆ™å¿…é¡»ä½¿ç”¨ç”±æ¨¡å‹ç»‘å®šå™¨åˆ›å»ºçš„å®ä½“å¯¹è±¡ã€‚ æœ€ç®€å•çš„æ–¹æ³•æ˜¯å°†å®ä½“çŠ¶æ€è®¾ç½®ä¸º Modifiedï¼Œå°±åƒå‰é¢æ‰€ç¤ºçš„ HttpPost Edit ä»£ç ä¸­æ‰€åšçš„é‚£æ ·ã€‚ ç„¶åå½“æ‚¨è°ƒç”¨<code>SaveChanges</code>æ—¶ï¼ŒEntity Framework å°†æ›´æ–°æ•°æ®åº“è¡Œçš„æ‰€æœ‰åˆ—ï¼Œå› ä¸ºä¸Šä¸‹æ–‡æ— æ³•çŸ¥é“æ‚¨æ›´æ”¹äº†å“ªäº›å±æ€§ã€‚</p>
<p>å¦‚æœä½ ä¸æƒ³ç”¨é¢„å…ˆè¯»å–çš„æ–¹å¼ï¼Œä½ æƒ³åœ¨ SQL Update è¯­å¥åªæ›´æ–°ç”¨æˆ·å®é™…æ›´æ”¹çš„å­—æ®µï¼Œä»£ç ä¼šæ¯”è¾ƒå¤æ‚ï¼Œä½ ä¸å¾—ä¸ä»¥æŸç§æ–¹å¼ä¿å­˜åŸæ¥çš„å€¼(æ¯”å¦‚éšè—å­—æ®µ)ï¼Œè¿™æ ·åœ¨è°ƒç”¨ HttpPost  <code>Edit</code>  æ–¹æ³•æ—¶å°±å¯ä»¥ä½¿ç”¨å®ƒä»¬ã€‚ç„¶åï¼Œä½ å¯ä»¥ä½¿ç”¨åŸå€¼æ¥åˆ›å»ºä¸€ä¸ª Student å®ä½“ï¼Œè°ƒç”¨åŸå§‹ç‰ˆæœ¬çš„ <code>Attach</code> æ–¹æ³•æ›´æ–°å®ä½“çš„å€¼åˆ°æ–°å€¼ï¼Œç„¶åè°ƒç”¨ <code>SaveChanges</code>ã€‚</p>
<h3 id="æµ‹è¯•ç¼–è¾‘é¡µé¢">æµ‹è¯•ç¼–è¾‘é¡µé¢</h3>
<p>è¿è¡Œåº”ç”¨ç¨‹åºå¹¶é€‰æ‹© <strong>Students</strong> é€‰é¡¹å¡ï¼Œç„¶åç‚¹å‡» <strong>Edit</strong> é“¾æ¥ã€‚</p>
<p><img src="crud/static/student-edit.png" alt="Students edit page"></p>
<p>ä¿®æ”¹éƒ¨åˆ†æ•°æ®å¹¶ä¸”ç‚¹å‡» <strong>Save</strong>ã€‚ é‡æ–°æ‰“å¼€ <strong>Index</strong> é¡µé¢æŸ¥çœ‹ä¿®æ”¹è¿‡çš„æ•°æ®ã€‚</p>
<h2 id="æ›´æ–°åˆ é™¤é¡µé¢">æ›´æ–°åˆ é™¤é¡µé¢</h2>
<p>åœ¨ <em>StudentController.cs</em>ä¸­ï¼ŒHttpGet Delete æ–¹æ³•çš„æ¨¡æ¿ä»£ç ä½¿ç”¨ <code>SingleOrDefaultAsync</code> æ–¹æ³•æ£€ç´¢æ‰€é€‰çš„Studentå®ä½“ï¼Œæ­£å¦‚ä½ åœ¨ Details å’Œ Edit æ–¹æ³•ä¸­çœ‹åˆ°çš„é‚£æ ·ã€‚ç„¶è€Œï¼Œè°ƒç”¨ <code>SaveChanges</code> å¤±è´¥æ—¶çš„è‡ªå®šä¹‰é”™è¯¯ä¿¡æ¯éœ€è¦ä¿®æ­£ï¼Œæ‚¨å°†ä¸ºæ­¤æ–¹æ³•åŠå…¶å¯¹åº”è§†å›¾æ·»åŠ ä¸€äº›åŠŸèƒ½ã€‚</p>
<p>æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„æ›´æ–°å’Œåˆ›å»ºæ“ä½œä¸€æ ·ï¼Œåˆ é™¤æ“ä½œéœ€è¦ä¸¤ä¸ªæ“ä½œæ–¹æ³•ã€‚ å“åº” GET è¯·æ±‚çš„è°ƒç”¨æ–¹æ³•æ˜¾ç¤ºä¸€ä¸ªè§†å›¾ï¼Œç»™äºˆç”¨æˆ·æ‰¹å‡†æˆ–å–æ¶ˆåˆ é™¤æ“ä½œçš„æœºä¼šã€‚ å¦‚æœç”¨æˆ·æ‰¹å‡†ï¼Œåˆ™ä¼šåˆ›å»º POST è¯·æ±‚ã€‚ å½“è¿™ç§æƒ…å†µå‘ç”Ÿæ—¶ï¼ŒHttpPost <code>Delete</code> æ–¹æ³•è¢«è°ƒç”¨ï¼Œç„¶åè¯¥æ–¹æ³•å®é™…æ‰§è¡Œåˆ é™¤æ“ä½œã€‚</p>
<p>æ‚¨å°†æ·»åŠ ä¸€ä¸ª try-catch ä»£ç å—åˆ° HttpPost <code>Delete</code> æ–¹æ³•æ¥å¤„ç†æ•°æ®åº“æ›´æ–°æ—¶å¯èƒ½å‘ç”Ÿçš„ä»»ä½•é”™è¯¯ã€‚ å¦‚æœå‘ç”Ÿé”™è¯¯ï¼ŒHttpPost Delete æ–¹æ³•è°ƒç”¨ HttpGet Delete æ–¹æ³•ï¼Œä¼ é€’ä¸€ä¸ªæŒ‡ç¤ºå‘ç”Ÿé”™è¯¯çš„å‚æ•°ã€‚ HttpGet Deleteæ–¹æ³•ç„¶åé‡æ–°æ˜¾ç¤ºç¡®è®¤é¡µé¢ä»¥åŠé”™è¯¯æ¶ˆæ¯ï¼Œä¸ºç”¨æˆ·æä¾›å–æ¶ˆæˆ–å†æ¬¡å°è¯•çš„æœºä¼šã€‚</p>
<p>ä½¿ç”¨ä»¥ä¸‹ä»£ç æ›¿æ¢ HttpGet <code>Delete</code> action æ–¹æ³•ï¼Œè¯¥ä»£ç ç®¡ç†é”™è¯¯æŠ¥å‘Šã€‚</p>
<pre><code class="lang-csharp" name="Main" highlight-lines="1,9,16-21">public async Task&lt;IActionResult&gt; Delete(int? id, bool? saveChangesError = false)
{
    if (id == null)
    {
        return NotFound();
    }

    var student = await _context.Students
        .AsNoTracking()
        .SingleOrDefaultAsync(m =&gt; m.ID == id);
    if (student == null)
    {
        return NotFound();
    }

    if (saveChangesError.GetValueOrDefault())
    {
        ViewData[&quot;ErrorMessage&quot;] =
            &quot;Delete failed. Try again, and if the problem persists &quot; +
            &quot;see your system administrator.&quot;;
    }

    return View(student);
}
</code></pre><p>è¿™æ®µä»£ç æ¥å—ä¸€ä¸ªå¯é€‰å‚æ•°ï¼ŒæŒ‡ç¤ºæ–¹æ³•æ˜¯å¦åœ¨ä¿å­˜æ›´æ”¹å¤±è´¥åè¢«è°ƒç”¨ã€‚ å½“ HttpGet <code>Delete</code> æ–¹æ³•è¢«è°ƒç”¨è€Œæ²¡æœ‰å…ˆå‰çš„å¤±è´¥æ—¶ï¼Œæ­¤å‚æ•°ä¸ºfalseã€‚ å½“ HttpPost <code>Delete</code> æ–¹æ³•å“åº”äºæ•°æ®åº“æ›´æ–°é”™è¯¯è°ƒç”¨è¯¥å‚æ•°æ—¶ï¼Œè¯¥å‚æ•°ä¸ºtrueï¼Œå¹¶å°†é”™è¯¯æ¶ˆæ¯ä¼ é€’ç»™è¯¥è§†å›¾ã€‚</p>
<h3 id="read-first-approach-æ¨¡å¼æ¥-httppost-åˆ é™¤">read-first approach æ¨¡å¼æ¥ HttpPost åˆ é™¤</h3>
<p>ä½¿ç”¨ä»¥ä¸‹ä»£ç æ›¿æ¢ HttpPost <code>Delete</code> actionæ–¹æ³•ï¼ˆå‘½åä¸º <code>DeleteConfirmed</code>ï¼‰ï¼Œè¯¥ä»£ç æ‰§è¡Œå®é™…çš„åˆ é™¤æ“ä½œå¹¶æ•è·ä»»ä½•æ•°æ®åº“æ›´æ–°é”™è¯¯ã€‚</p>
<pre><code class="lang-csharp" name="Main" highlight-lines="6,8-11,13-14,18-23">[HttpPost, ActionName(&quot;Delete&quot;)]
[ValidateAntiForgeryToken]
public async Task&lt;IActionResult&gt; DeleteConfirmed(int id)
{
    var student = await _context.Students
        .AsNoTracking()
        .SingleOrDefaultAsync(m =&gt; m.ID == id);
    if (student == null)
    {
        return RedirectToAction(&quot;Index&quot;);
    }

    try
    {
        _context.Students.Remove(student);
        await _context.SaveChangesAsync();
        return RedirectToAction(&quot;Index&quot;);
    }
    catch (DbUpdateException /* ex */)
    {
        //Log the error (uncomment ex variable name and write a log.)
        return RedirectToAction(&quot;Delete&quot;, new { id = id, saveChangesError = true });
    }
}
</code></pre><p>æ­¤ä»£ç æ£€ç´¢æ‰€é€‰å®ä½“ï¼Œç„¶åè°ƒç”¨ <code>Remove</code> æ–¹æ³•å°†å®ä½“çš„çŠ¶æ€è®¾ç½®ä¸º <code>Deleted</code>ã€‚ å½“è°ƒç”¨ <code>SaveChanges</code> æ–¹æ³•æ—¶ï¼Œä¼šç”Ÿæˆä¸€ä¸ª SQL DELETE å‘½ä»¤ã€‚</p>
<h3 id="create-and-attach-æ¨¡å¼æ¥-httppost-åˆ é™¤">create-and-attach æ¨¡å¼æ¥ HttpPost åˆ é™¤</h3>
<p>å¦‚æœåœ¨å¤§æ•°æ®åº”ç”¨ç¨‹åºä¸­æé«˜æ€§èƒ½æ˜¯ä¼˜å…ˆçº§ï¼Œåˆ™å¯ä»¥é€šè¿‡ä»…ä½¿ç”¨ä¸»é”®å€¼å®ä¾‹åŒ– Student å®ä½“ï¼Œç„¶åå°†å®ä½“çŠ¶æ€è®¾ç½®ä¸º <code>Deleted</code>æ¥é¿å…ä¸å¿…è¦çš„SQLæŸ¥è¯¢ã€‚ è¿™å°±æ˜¯å®ä½“æ¡†æ¶ä¸ºäº†åˆ é™¤å®ä½“è€Œéœ€è¦çš„ã€‚ ï¼ˆä¸è¦æŠŠè¿™æ®µä»£ç æ”¾åœ¨ä½ çš„é¡¹ç›®ä¸­;è¿™é‡Œä»…ä»…ä¸ºäº†è¯´æ˜ä¸€ä¸ªé€‰æ‹©æ–¹æ¡ˆï¼‰</p>
<pre><code class="lang-csharp" name="Main" highlight-lines="7-8">[HttpPost]
[ValidateAntiForgeryToken]
public async Task&lt;IActionResult&gt; DeleteConfirmed(int id)
{
    try
    {
        Student studentToDelete = new Student() { ID = id };
        _context.Entry(studentToDelete).State = EntityState.Deleted;
        await _context.SaveChangesAsync();
        return RedirectToAction(&quot;Index&quot;);
    }
    catch (DbUpdateException /* ex */)
    {
        //Log the error (uncomment ex variable name and write a log.)
        return RedirectToAction(&quot;Delete&quot;, new { id = id, saveChangesError = true });
    }
}
</code></pre><p>å¦‚æœå®ä½“æœ‰ç›¸å…³æ•°æ®ä¹Ÿåº”è¯¥è¢«åˆ é™¤ï¼Œè¯·ç¡®ä¿åœ¨æ•°æ®åº“ä¸­é…ç½®äº†çº§è”åˆ é™¤ã€‚ é€šè¿‡è¿™ç§å®ä½“åˆ é™¤æ–¹æ³•ï¼ŒEF å¯èƒ½æ— æ³•æ„è¯†åˆ°æœ‰å…³è”çš„å®ä½“åº”è¯¥è¢«åˆ é™¤ã€‚</p>
<h3 id="æµ‹è¯•åˆ é™¤é¡µé¢">æµ‹è¯•åˆ é™¤é¡µé¢</h3>
<p>åœ¨ <em>Views/Student/Delete.cshtml</em> ä¸­ï¼Œåœ¨h2æ ‡é¢˜å’Œh3æ ‡é¢˜ä¹‹é—´æ·»åŠ é”™è¯¯ä¿¡æ¯ï¼ŒæŒ‰ç…§å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p>
<pre><code class="lang-html" highlight-lines="2">&lt;h2&gt;Delete&lt;/h2&gt;
&lt;p class=&quot;text-danger&quot;&gt;@ViewData[&quot;ErrorMessage&quot;]&lt;/p&gt;
&lt;h3&gt;Are you sure you want to delete this?&lt;/h3&gt;
</code></pre><p>è¿è¡Œé¡µé¢é€‰æ‹© <strong>Students</strong> é€‰é¡¹å¡å¹¶ç‚¹å‡» <strong>Delete</strong> é“¾æ¥ï¼š</p>
<p><img src="crud/static/student-delete.png" alt="Delete confirmation page"></p>
<p>ç‚¹å‡» <strong>Delete</strong>ã€‚Index é¡µé¢æ˜¾ç¤ºæœªè¢«åˆ é™¤çš„å­¦ç”Ÿã€‚ ï¼ˆæ‚¨å°†åœ¨å¹¶å‘æ•™ç¨‹ä¸­çœ‹åˆ°å¦‚ä½•å¤„ç†ä»£ç çš„ç¤ºä¾‹ã€‚ï¼‰</p>
<h2 id="å…³é—­æ•°æ®åº“è¿æ¥">å…³é—­æ•°æ®åº“è¿æ¥</h2>
<p>è¦ç¡®ä¿æ•°æ®åº“è¿æ¥æ­£ç¡®çš„å…³é—­å¹¶é‡Šæ”¾æ‰€å ç”¨çš„èµ„æºï¼Œå½“ä½ ä½¿ç”¨å®Œæ•°æ®åº“ä¸Šä¸‹é—®å€™ï¼Œéœ€è¦å°†å…¶é”€æ¯ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè„šæ‰‹æ¶ä»£ç åœ¨Studentæ§åˆ¶å™¨ç±»çš„æœ€åéƒ¨åˆ†æä¾›äº†ä¸€ä¸ªDisposeæ–¹æ³•ï¼Œå¦‚ä¸‹é¢çš„ä»£ç ï¼š</p>
<p>è¦ç¡®ä¿æ–½æ”¾æ•°æ®åº“è¿æ¥å ç”¨çš„èµ„æºï¼Œæ•°æ®åº“ä¸Šä¸‹æ–‡å®ä¾‹å¿…é¡»åœ¨ä½ ç”¨å®Œä»¥åç«‹å³é‡Šæ”¾ã€‚ASP.NET Core å†…ç½®<a href="../../fundamentals/dependency-injection.html">ä¾èµ–æ³¨å…¥</a> å¯ä»¥å¸®åŠ©ä½ è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>åœ¨ <em>Startup.cs</em> ä½ å¯ä»¥è°ƒç”¨ <a href="https://github.com/aspnet/EntityFramework/blob/03bcb5122e3f577a84498545fcf130ba79a3d987/src/Microsoft.EntityFrameworkCore/EntityFrameworkServiceCollectionExtensions.cs">AddDbContext æ‰©å±•æ–¹æ³•</a> åœ¨ ASP.NET DI å®¹å™¨ä¸­è®¾ç½® <code>DbContext</code> ç±»ã€‚æ–¹æ³•é»˜è®¤æŠŠæœåŠ¡ç”Ÿå‘½å‘¨æœŸè®¾ç½®ä¸º <code>Scoped</code>ã€ <code>Scoped</code> æ„å‘³ç€ä¸Šä¸‹æ–‡å¯¹è±¡ç”Ÿå‘½å‘¨æœŸå’Œ web è¯·æ±‚ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸€è‡´çš„ï¼Œ åœ¨è¯·æ±‚ç»“æŸçš„æ—¶å€™ä¼šè‡ªåŠ¨è°ƒç”¨ <code>Dispose</code> æ–¹æ³•ã€‚</p>
<h2 id="å¤„ç†äº‹åŠ¡">å¤„ç†äº‹åŠ¡</h2>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒEntity Framework éšå¼çš„å®ç°äº‹åŠ¡å¤„ç†ã€‚å½“ä½ å¯¹å¤šä¸ªè¡¨æˆ–è¡Œè¿›è¡Œäº†æ›´æ”¹åè°ƒç”¨ <code>SaveChanges</code>ï¼ŒEntity Framework ä¼šè‡ªåŠ¨ç¡®ä¿ä½ çš„æ‰€æœ‰æ›´æ”¹å…¨éƒ¨æˆåŠŸä¿å­˜åˆ°æ•°æ®åº“æˆ–å…¨éƒ¨ä¿å­˜å¤±è´¥ã€‚å¦‚æœæŸäº›æ›´æ–°å®Œæˆï¼Œä¹‹åå‘ç”Ÿäº†ä¸€ä¸ªé”™è¯¯ï¼Œé‚£ä¹‹å‰å®Œæˆçš„æ›´æ–°å°†è‡ªåŠ¨å…¨éƒ¨å›æ»šã€‚å½“ä½ éœ€è¦å¯¹äº‹åŠ¡çš„æ›´å¤šçš„æ§åˆ¶æƒæ—¶â€”â€”æ¯”å¦‚æ‚¨æƒ³è¦åœ¨ä¸€æ¬¡äº‹åŠ¡ä¸­åŒ…å«åœ¨ Entity Framework ä¹‹å¤–çš„æ“ä½œâ€”â€”å‚è§<a href="https://docs.microsoft.com/ef/core/saving/transactions">äº‹åŠ¡</a>ã€‚</p>
<h2 id="no-tracking-æŸ¥è¯¢">No-tracking æŸ¥è¯¢</h2>
<p>å½“æ•°æ®åº“ä¸Šä¸‹æ–‡æ£€ç´¢æ•°æ®åº“è¡¨è¡Œå¹¶åˆ›å»ºå¯¹åº”çš„çš„å®ä½“å¯¹è±¡æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒå°†è·Ÿè¸ªå†…å­˜ä¸­çš„å®ä½“æ˜¯å¦ä¸æ•°æ®åº“ä¸­çš„å®ä½“åŒæ­¥ã€‚ å†…å­˜ä¸­çš„æ•°æ®å……å½“ç¼“å­˜ï¼Œå¹¶åœ¨æ›´æ–°å®ä½“æ—¶ä½¿ç”¨ã€‚ è¿™ç§ç¼“å­˜åœ¨ Web åº”ç”¨ç¨‹åºä¸­é€šå¸¸æ˜¯ä¸å¿…è¦çš„ï¼Œå› ä¸ºä¸Šä¸‹æ–‡å®ä¾‹é€šå¸¸æ˜¯çŸ­æš‚çš„ï¼ˆä¸ºæ¯ä¸ªè¯·æ±‚åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ï¼‰ï¼Œå¹¶ä¸”ä¸Šä¸‹æ–‡é€šå¸¸ä¼šåœ¨å†æ¬¡è¯»å–è¯¥å®ä½“ä¹‹å‰è‡ªåŠ¨æ–½æ”¾ã€‚</p>
<p>æ‚¨å¯ä»¥é€šè¿‡è°ƒç”¨ <code>AsNoTracking</code> æ–¹æ³•æ¥ç¦ç”¨å¯¹å†…å­˜ä¸­å®ä½“å¯¹è±¡çš„è·Ÿè¸ªã€‚ æ‚¨å¯ä»¥ä»¥ä¸‹å…¸å‹åœºæ™¯ä¸­ä½¿ç”¨ï¼š</p>
<ul>
<li><p>åœ¨ä¸Šä¸‹æ–‡ç”Ÿå‘½å‘¨æœŸå†…ï¼Œæ‚¨ä¸éœ€è¦æ›´æ–°ä»»ä½•å®ä½“ï¼Œå¹¶ä¸”æ‚¨ä¸éœ€è¦ EF <a href="read-related-data.html">é€šè¿‡å•ç‹¬æ£€ç´¢çš„å®ä½“è‡ªåŠ¨åŠ è½½å¯¼èˆªå±æ€§</a>ã€‚ è¿™äº›æ¡ä»¶é€šå¸¸åœ¨æ§åˆ¶å™¨çš„ HttpGet æ“ä½œæ–¹æ³•ä¸­å¾—åˆ°æ»¡è¶³ã€‚</p>
</li>
<li><p>å¦‚æœæ‚¨æ­£åœ¨è¿è¡Œä¸€ä¸ªæ£€ç´¢å¤§æ•°æ®çš„æŸ¥è¯¢ï¼Œä½†æ˜¯åªæœ‰å¾ˆå°çš„ä¸€éƒ¨åˆ†è¿”å›çš„æ•°æ®å°†è¢«æ›´æ–°ã€‚ è¿™ä¸ªæ—¶å€™å…³é—­å¤§æ•°æ®æŸ¥è¯¢çš„è·Ÿè¸ªå¯èƒ½ä¼šæ›´æœ‰æ•ˆï¼Œå¹¶ä¸”ç¨åå•ç‹¬ä¸ºéœ€è¦æ›´æ–°çš„å‡ ä¸ªå®ä½“å†æ¬¡è¿è¡ŒæŸ¥è¯¢ã€‚</p>
</li>
<li><p>æ‚¨æƒ³è¦é™„åŠ ä¸€ä¸ªå®ä½“æ¥æ›´æ–°å®ƒï¼Œä½†æ˜¯ä¹‹å‰æ‚¨å› ä¸ºä¸åŒçš„ç›®çš„æ£€ç´¢äº†åŒä¸€ä¸ªå®ä½“ã€‚ å› ä¸ºå®ä½“å·²è¢«æ•°æ®åº“ä¸Šä¸‹æ–‡è·Ÿè¸ªï¼Œæ‰€ä»¥æ‚¨ä¸èƒ½é™„åŠ è¦æ›´æ”¹çš„å®ä½“ã€‚ å¤„ç†è¿™ç§æƒ…å†µçš„ä¸€ç§æ–¹æ³•æ˜¯åœ¨ä¹‹å‰çš„æŸ¥è¯¢ä¸­è°ƒç”¨ <code>AsNoTracking</code> ã€‚</p>
</li>
</ul>
<p>æ›´å¤šä¿¡æ¯è¯·å‚è€ƒ <a href="https://docs.microsoft.com/en-us/ef/core/querying/tracking">Tracking å¯¹æ¯” No-Tracking</a>.</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>æ‚¨ç°åœ¨æ‹¥æœ‰ä¸€å¥—é’ˆå¯¹ Student å®ä½“å®Œæˆçš„ CRUD æ“ä½œçš„é¡µé¢ã€‚åœ¨ä¸‹ä¸€èŠ‚æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šæ‰©å±• <strong>Index</strong> é¡µé¢å¢åŠ æ’åºï¼Œåˆ†ç»„ï¼Œè¿‡æ»¤ä»¥åŠåˆ†é¡µçš„åŠŸèƒ½ã€‚</p>
<div class="step-by-step"><p><a href="intro.html">ä¸Šä¸€èŠ‚</a>
<a href="sort-filter-page.html">ä¸‹ä¸€èŠ‚</a>  </p>
</div>
</article>
          </div>
          <div class="col-md-10">
                    <a name="cloudcomment">
                        <div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div>
                    </a>          
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/dotnetcore/aspnetcore-doc-cn/blob/dev/aspnetcore/data/ef-mvc/crud.md/#L1" class="contribution-link">&#25913;&#36827;&#25991;&#26723;</a>
                  </li>
                                                  <li>
                                              <span style="margin-left: 10px; margin-top: 3px; margin-bottom: 3px;" class="contribution-link"><a class="cloud-tie-join-count" href="#cloudcomment">
                                                  <span class="icon-comment"></span>
                                                  <span class="join-count">0</span>
                                                  <span class="join-text">è¯„è®º</span>
                                              </a></span>
                                          </li>
                                          <li>
                                              <div style="margin-left: 10px; margin-top: 3px; margin-bottom: 3px;" class="bdsharebuttonbox">
                                                  <a href="#" class="bds_more" data-cmd="more"></a>
                                                  <a href="#" class="bds_mshare" data-cmd="mshare" title="åˆ†äº«åˆ°ä¸€é”®åˆ†äº«"></a>
                                                  <a href="#" class="bds_weixin" data-cmd="weixin" title="åˆ†äº«åˆ°å¾®ä¿¡"></a>
                                                  <a href="#" class="bds_tsina" data-cmd="tsina" title="åˆ†äº«åˆ°æ–°æµªå¾®åš"></a>
                                                  <a href="#" class="bds_sqq" data-cmd="sqq" title="åˆ†äº«åˆ°QQå¥½å‹"></a>
                                                  <a href="#" class="bds_copy" data-cmd="copy" title="åˆ†äº«åˆ°å¤åˆ¶ç½‘å€"></a>
                                                  <a href="#" class="bds_print" data-cmd="print" title="åˆ†äº«åˆ°æ‰“å°"></a>
                                              </div>
                                          </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">è¿”å›é¡¶éƒ¨</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">è¿”å›é¡¶éƒ¨</a>
            </span>
            
            <span>Copyright Â© 2015-2017 Microsoft<br>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
      <script>
      (function(){
          var bp = document.createElement('script');
          var curProtocol = window.location.protocol.split(':')[0];
          if (curProtocol === 'https'){
         bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        }
        else{
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(bp, s);
      })();
      </script>    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
    
    <script src="https://img1.cache.netease.com/f2e/tie/yun/sdk/loader.js"></script>
    <script>
     
        var url = window.location.href;
        
        url = url.replace(window.location.hash,"");
        url = url.replace(window.location.search, "");
    
        var cloudTieConfig = {
            url: url, 
            sourceId: "",
            productKey: "1f2ab3895f9d44a0b3b90ab7a8c4e01b",
            target: "cloud-tie-wrapper"
        };
        var yunManualLoad = true;
        Tie.loader("aHR0cHM6Ly9hcGkuZ2VudGllLjE2My5jb20vcGMvbGl2ZXNjcmlwdC5odG1s", true);
    </script>
    <script type="text/javascript">window._bd_share_config = { "common": { "bdSnsKey": {}, "bdText": "", "bdMini": "2", "bdMiniList": false, "bdPic": "", "bdStyle": "0", "bdSize": "16" }, "share": {} }; with (document) 0[(getElementsByTagName('head')[0] || body).appendChild(createElement('script')).src = 'http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion=' + ~(-new Date() / 36e5)];</script>
  </body>
</html>
